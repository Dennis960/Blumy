(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))r(s);new MutationObserver(s=>{for(const o of s)if(o.type==="childList")for(const a of o.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&r(a)}).observe(document,{childList:!0,subtree:!0});function n(s){const o={};return s.integrity&&(o.integrity=s.integrity),s.referrerPolicy&&(o.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?o.credentials="include":s.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function r(s){if(s.ep)return;s.ep=!0;const o=n(s);fetch(s.href,o)}})();const c=document.querySelector(".app");async function g(e,t){const n=new URLSearchParams;n.append("ssid",e),n.append("password",t);const r=await d("/connect",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:n});return r.ok?{error:null}:{error:"Error submitting credentials: "+r.statusText}}async function w(e){const t=new URLSearchParams(e),n=await d("/mqttSetup",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:t});return n.ok?{error:null}:{error:"Error submitting MQTT configuration: "+n.statusText}}async function v(){const e=await d("/networks");if(!e.ok)throw new Error("Error scanning networks: "+e.statusText);return await e.json()}const d=new Proxy(window.fetch,{apply:async(e,t,n)=>{E();const r=await e.apply(t,n);return L(),r}});function E(){c.classList.add("app--loading")}function L(){c.classList.remove("app--loading")}const f=[];function m(e){f.push(e)}function h(e){f.forEach(t=>t(e))}function p(e){c.setAttribute("data-current",e),h(e)}function b(){const e=parseInt(c.getAttribute("data-current"));p(e-1)}function i(){const e=parseInt(c.getAttribute("data-current"));p(e+1)}document.getElementById("stepper").addEventListener("click",e=>{const t=parseInt(e.target.getAttribute("data-step"));t&&t<getCurrentPage()&&p(t)});function I(e){var n;document.querySelectorAll("[data-step]").forEach(r=>r.classList.remove("active","done"));for(let r=1;r<e;r++)document.querySelector(`[data-step="${r}"]`).classList.add("done");(n=document.querySelector(`[data-step="${e}"]`))==null||n.classList.add("active"),document.querySelectorAll("[data-page]").forEach(r=>r.style.display="none");const t=document.querySelector(`[data-page="${e}"]`);t&&(t.style.display="")}m(I);document.querySelectorAll(".back").forEach(e=>{e.addEventListener("click",t=>{b()})});document.getElementById("status-form").addEventListener("submit",e=>{e.preventDefault(),i()});document.getElementById("networks-form").addEventListener("submit",e=>{e.preventDefault(),i()});document.getElementById("credentials-form").addEventListener("submit",async e=>{e.preventDefault();const t=e.target.ssid.value,n=e.target.password.value,r=document.getElementById("credentials-error");if(r.style.display="none",(await g(t,n)).error){r.innerText=e.error,r.style.display="";return}i()});document.getElementById("mqtt-form").addEventListener("submit",async e=>{e.preventDefault();const t=e.target.server.value,n=e.target.port.value,r=e.target.user.value,s=e.target.password.value,o=e.target.topic.value,a=e.target.clientid.value,l={server:t,port:n,user:r,password:s,topic:o,clientId:a},u=document.getElementById("mqtt-error");if(u.style.display="none",t==""){i();return}if((await w(l)).error){u.innerText=e.error,u.style.display="";return}i()});for(const e of document.getElementsByClassName("password-visibility"))e.addEventListener("click",t=>{const n=t.target.getAttribute("data-target"),r=document.getElementById(n);r.type==="password"?(r.type="text",t.target.innerHTML="&#128064;"):(r.type="password",t.target.innerHTML="&#128065;")});function S(e){const n=document.getElementById("wifi-template").content.cloneNode(!0),r=n.querySelector(".button");r.value=e.ssid,r.addEventListener("click",()=>document.getElementById("ssid").value=e.ssid),n.querySelector(".ssid").textContent=e.ssid,e.secure==7&&(n.querySelector(".secure").style.display="none");const o=1-(Math.max(-100,Math.min(e.rssi,-30))+100)/70;return n.querySelectorAll(".wave").forEach((a,l)=>{l+1>o*4&&a.classList.add("wifi__wave--active")}),n}function T(e){const t=document.getElementById("networks-list");t.innerHTML="",e.forEach(n=>t.appendChild(n))}document.getElementById("refresh-networks").addEventListener("click",e=>{y()});async function y(){const e=document.getElementById("networks-error");e.style.display="none";try{const t=await v();t.sort((n,r)=>r.rssi-n.rssi),T(t.map(S))}catch(t){e.innerText=t.message,e.style.display=""}}m(e=>{e==2&&y()});setInterval(async()=>{const t=await(await d("/isConnected")).json();console.log(t),t===1&&(window.location.href="/")},3e3);
