(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))n(s);new MutationObserver(s=>{for(const o of s)if(o.type==="childList")for(const a of o.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&n(a)}).observe(document,{childList:!0,subtree:!0});function r(s){const o={};return s.integrity&&(o.integrity=s.integrity),s.referrerPolicy&&(o.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?o.credentials="include":s.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function n(s){if(s.ep)return;s.ep=!0;const o=r(s);fetch(s.href,o)}})();const u=document.querySelector(".app");async function g(){return await(await l("/isConnected")).json()}async function m(e,t,r){const n=new FormData;n.append("file",e);const s=document.getElementById(r);s.style.width="0%",s.parentElement.style.display="block";let o=!1;async function a(){const y=await(await l("/update/percentage")).json();s.style.width=`${y}%`,o||setTimeout(a,100)}a();let i=l(t,{method:"POST",body:n});return i.then(c=>(o=!0,c)).catch(c=>(o=!0,c)),i=await i,i.ok?{error:null}:(s.parentElement.style.display="none",{error:"Error uploading file: "+i.statusText})}async function h(e,t){const r=new URLSearchParams;r.append("ssid",e),r.append("password",t);const n=await l("/connect",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:r});return n.ok?{error:null}:{error:"Error submitting credentials: "+n.statusText}}async function v(e){const t=new URLSearchParams(e),r=await l("/mqttSetup",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:t});return r.ok?{error:null}:{error:"Error submitting MQTT configuration: "+r.statusText}}async function b(){const e=await l("/networks");if(!e.ok)throw new Error("Error scanning networks: "+e.statusText);return await e.json()}async function L(){const e=await l("/reset",{method:"POST"});return e.ok?{error:null}:{error:"Error rebooting: "+e.statusText}}const l=new Proxy(window.fetch,{apply:async(e,t,r)=>{S();const n=await e.apply(t,r);return T(),n}});function S(){u.classList.add("loading")}function T(){u.classList.remove("loading")}const w=[];function p(e){w.push(e)}function I(e){w.forEach(t=>t(e))}document.addEventListener("DOMContentLoaded",()=>{f(1)});function f(e){u.setAttribute("data-current",e),I(e)}function B(){const e=parseInt(u.getAttribute("data-current"));f(e-1)}function d(){const e=parseInt(u.getAttribute("data-current"));f(e+1)}document.getElementById("stepper").addEventListener("click",e=>{const t=parseInt(e.target.getAttribute("data-step")),r=parseInt(u.getAttribute("data-current"));t&&t<r&&f(t)});function P(e){var r;document.querySelectorAll("[data-step]").forEach(n=>n.classList.remove("active","done"));for(let n=1;n<e;n++)document.querySelector(`[data-step="${n}"]`).classList.add("done");(r=document.querySelector(`[data-step="${e}"]`))==null||r.classList.add("active"),document.querySelectorAll("[data-page]").forEach(n=>n.style.display="none");const t=document.querySelector(`[data-page="${e}"]`);t&&(t.style.display="")}p(P);document.querySelectorAll(".back").forEach(e=>{e.addEventListener("click",t=>{B()})});document.querySelectorAll(".skip").forEach(e=>{e.addEventListener("click",t=>{d()})});document.getElementById("status-form").addEventListener("submit",e=>{e.preventDefault(),d()});document.getElementById("firmware-form").addEventListener("submit",async e=>{e.preventDefault();const t=e.target.firmware.files[0],r=e.target.littlefs.files[0];if(!t&&!r){d();return}function n(){e.target.querySelectorAll("button").forEach(a=>{a.disabled=!0})}function s(){e.target.querySelectorAll("button").forEach(a=>{a.disabled=!1})}n();const o=document.getElementById("firmware-error");if(o.style.display="none",r&&(await m(r,"/update/littlefs","littlefs-progress")).error){o.innerText=e.error,o.style.display="",s();return}if(t&&(await m(t,"/update/firmware","firmware-progress")).error){o.innerText=e.error,o.style.display="",s();return}for(o.innerText="Firmware uploaded successfully. Rebooting. The site will refresh automatically.";;){await new Promise(a=>setTimeout(a,1e3));try{await g();break}catch{}}window.location.reload()});document.getElementById("credentials-form").addEventListener("submit",async e=>{e.preventDefault();const t=e.target.ssid.value,r=e.target.password.value,n=document.getElementById("credentials-error");if(n.style.display="none",(await h(t,r)).error){n.innerText=e.error,n.style.display="";return}d()});document.getElementById("mqtt-form").addEventListener("submit",async e=>{e.preventDefault();const t=e.target.server.value,r=e.target.port.value,n=e.target.user.value,s=e.target.password.value,o=e.target.topic.value,a=e.target.clientid.value,i={server:t,port:r,user:n,password:s,topic:o,clientId:a},c=document.getElementById("mqtt-error");if(c.style.display="none",t==""){d();return}if((await v(i)).error){c.innerText=e.error,c.style.display="";return}d()});document.getElementById("reboot-form").addEventListener("submit",async e=>{e.preventDefault();const t=await L(),r=document.getElementById("reboot-error");if(t.error){r.innerText=e.error,r.style.display="";return}f(1)});for(const e of document.getElementsByClassName("password-visibility"))e.addEventListener("click",t=>{const r=t.target.getAttribute("data-target"),n=document.getElementById(r);n.type==="password"?(n.type="text",t.target.innerHTML="&#128064;"):(n.type="password",t.target.innerHTML="&#128065;")});function x(e){const r=document.getElementById("wifi-template").content.cloneNode(!0),n=r.querySelector(".button");n.value=e.ssid,n.addEventListener("click",()=>{document.getElementById("ssid").value=e.ssid,d()}),r.querySelector(".ssid").textContent=e.ssid,e.secure==7&&(r.querySelector(".secure").style.display="none");const o=1-(Math.max(-100,Math.min(e.rssi,-30))+100)/70;return r.querySelectorAll(".wave").forEach((a,i)=>{i+1>o*4&&a.classList.add("wifi__wave--active")}),r}function q(e){const t=document.getElementById("networks-list");t.innerHTML="",e.forEach(r=>t.appendChild(r))}document.getElementById("refresh-networks").addEventListener("click",e=>{E()});async function E(){const e=document.getElementById("networks-error");e.style.display="none";try{const t=await b();t.sort((r,n)=>n.rssi-r.rssi),q(t.map(x))}catch(t){e.innerText=t.message,e.style.display=""}}p(e=>{e==2&&E()});async function k(){const e=await g(),t=document.getElementById("status-online"),r=document.getElementById("status-offline");e===1?(t.style.display="",r.style.display="none"):(t.style.display="none",r.style.display="")}p(e=>{e==2&&k()});
